function getColor(){jQuery.ajax({type:"GET",url:esAudioPlayer_plugin_URL+"/getcolor.php",dataType:"json",data:"",success:function(a){esplayer_basecolor_play=a.basecolor_play;esplayer_symbolcolor_play=a.symbolcolor_play;esplayer_basecolor_stop=a.basecolor_stop;esplayer_symbolcolor_stop=a.symbolcolor_stop;esplayer_basecolor_pause=a.basecolor_pause;esplayer_symbolcolor_pause=a.symbolcolor_pause;esplayer_color_slider_line=a.color_slider_line;esplayer_color_slider_knob=a.color_slider_knob;esplayer_shadowsize=a.shadowsize;esplayer_shadowcolor=a.shadowcolor;esplayer_color_loaded=true},error:function(a,b,c){if(esplayer_debug){alert(b);alert("XMLHttpRequest: "+a+"\n"+"textStatus:"+b+"\n"+"errorThrown: "+c)}esplayer_color_loaded=true}})}var esplayer_debug=false;soundManager.url=esAudioPlayer_plugin_URL+"/swf/";soundManager.flashVersion=8;soundManager.useFlashBlock=false;soundManager.useHTML5Audio=true;soundManager.preferFlash=true;soundManager.debugMode=false;soundManager.debugFlash=false;soundManager.allowpolling=true;soundManager.useConsole=true;var Array_EsAudioPlayer=new Array;var esp_playing_no=0;var soundManager_ready=false;soundManager.onready(function(){soundManager_ready=true});getColor();var esplayer_basecolor_play="#dddddd";var esplayer_symbolcolor_play="#888888";var esplayer_basecolor_stop="#dddddd";var esplayer_symbolcolor_stop="#888888";var esplayer_basecolor_pause="#dddddd";var esplayer_symbolcolor_pause="#888888";var esplayer_color_slider_line="#dddddd";var esplayer_color_slider_knob="#888888";var esplayer_shadowsize=.1;var esplayer_shadowcolor="#888888";var esplayer_color_loaded=false;var esplayer_jquery_prepared=false;jQuery(document).ready(function(){esplayer_jquery_prepared=true});var EsAudioPlayer=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function p(){o.init()}this.basecolor_play="";this.symbolcolor_play="";this.basecolor_stop="";this.symbolcolor_stop="";this.basecolor_pause="";this.symbolcolor_pause="";this.color_slider_line="";this.color_slider_knob="";this.n=0;this.sURLs=new Array;this.sURLs[0]=c;this.mySound=new Array;this.mySoundPosition=new Array;this.play=false;this.pause=false;this.created=false;this.preventDrawing=false;this.flgInitializing_beforePlaying=false;this.canvas=0;this.that=this;this.id=b;this.img_id=l;this.width_org=d;this.height_org=e;this.width=d;this.height=e;this.v_pos_org=f;this.v_pos=f;this.canvas_width=d;this.canvas_height=e;this.shw_rate=g;this.shw_color=h;this.shw_size=0;this.start_anim_retry=0;this.start_time=0;this.anim_ok=false;this.setting_ok=false;this.nowPlaying=0;this.border_img=i;this.debug_msg="";this.duration=this.calc_duration(k);this.mode=a;this.loop=j;this.tt_id_list=new Array;var o=this;this.init_id=setInterval(p,100)};EsAudioPlayer.prototype.init=function(){function g(){a.anim()}function f(){a.initSound()}function b(){a.getSetting()}if(!esplayer_jquery_prepared)return;clearInterval(this.init_id);var a=this;this.GetSizeInPx();this.sx_st=this.height;this.sx_en=this.width-this.height*.3;this.sy=this.canvas_height/2;this.slider_x=-1;this.slider_y=-1;this.slider_mouse_ofs_x=0;this.slider_mouse_ofs_y=0;this.slider_length=this.width>=this.height*2?this.sx_en-this.sx_st:0;this.slider_drag=false;this.slider_width=this.height*.07;this.slider_height=this.height*.4;this.slider_img=new Image;if(this.mode=="simple"){this.isIPhone=(new RegExp("(iPhone|iPod|iPad)","i")).test(navigator.userAgent);this.isAndroid=(new RegExp("(Android)","i")).test(navigator.userAgent);this.isSmartphone="ontouchstart"in window;this.isGecko=navigator.userAgent.match(/SeaMonkey|Firefox/i)&&navigator.userAgent.match(/rv:[56].0/i);this.isIE=(new RegExp("MSIE (3|4|5|6|7|8)","i")).test(navigator.userAgent);jQuery("#"+this.id).bind(this.isSmartphone?"touchstart":"mousedown",function(b){a.onClick(b)})}this.getsetting_id=setInterval(b,20);if(!this.isIE){if(this.mode=="simple"){function c(){a.initCanvas()}this.initCanvas_id=setInterval(c,20)}else{this.anim_ok=true}}else{function d(){a.startAnim_IE()}this.int_IE_id=setInterval(d,20)}if(this.mode=="slideshow"){this.tt_id_list=this.sURLs[0].split(",");this.tt_obj=new EsAudioPlayer_tt(this)}else{}if(this.mode=="imgclick"){var e=jQuery("#"+this.img_id);if(jQuery("#"+this.img_id).parent().get(0).tagName.toUpperCase()=="A"){jQuery("#"+this.img_id).parent().contents().unwrap()}jQuery(e).bind(a.isSmartphone?"touchstart":"mousedown",function(b){a.func_play_stop()})}setInterval(f,200);setInterval(g,500);Array_EsAudioPlayer[Array_EsAudioPlayer.length]=this};EsAudioPlayer.prototype.GetSizeInPx=function(){var a=document.createElement("div");a.setAttribute("id","tmpdiv"+this.id);document.getElementsByTagName("body")[0].appendChild(a);var b=jQuery("#tmpdiv"+this.id);var c=jQuery("#"+this.id+"_tmpspan");jQuery(b).css("width",this.width_org);this.width=parseInt(jQuery(b).css("width").replace("px",""));jQuery(b).css("width",this.height_org);this.height=parseInt(jQuery(b).css("width").replace("px",""));var d=this.v_pos_org;var e=d.substr(0,1);if(e!="-")e="";if(e=="-")d=d.substr(1);jQuery(b).css("width",d);this.v_pos=parseInt(jQuery(b).css("width").replace("px",""));if(e=="-")this.v_pos=-this.v_pos;jQuery(c).css("top",this.v_pos+"px")};EsAudioPlayer.prototype.calc_duration=function(a){var b=0;var c="";var d=0;if(a=="")return 0;split1=a.split(":");if(split1.length==2){b=parseInt(split1[0])*60*1e3;c=split1[1]}else{c=split1[0]}b+=parseFloat(c)*1e3;return b};EsAudioPlayer.prototype.startAnim_IE=function(){this.start_anim_retry++;if(this.start_anim_retry>50){var a=document.getElementById(this.id);var b=!!(a.getContext&&a.getContext("2d"));if(b){this.initCanvas();clearInterval(this.int_IE_id);this.anim_ok=true;return}}};EsAudioPlayer.prototype.initCanvas=function(){if(!this.setting_ok)return;this.canvas=document.getElementById(this.id);this.canvas_width=Math.ceil(this.width+this.shw_size);this.canvas_height=Math.ceil(this.height+this.shw_size);if(this.slider_length){}if(!(this.canvas!=null)&&esplayer_debug)alert("Canvas could not be prepared. "+this.id+" is null");if(1){this.canvas.setAttribute("width",this.canvas_width);this.canvas.setAttribute("height",this.canvas_height);if(this.isIE){this.canvas.setAttribute("width",this.canvas_width);this.canvas.setAttribute("height",this.canvas_height)}}this.anim_ok=true;clearInterval(this.initCanvas_id)};EsAudioPlayer.prototype.getSetting=function(){if(esplayer_color_loaded==false)return;if(this.basecolor_play=="")this.basecolor_play=esplayer_basecolor_play;if(this.symbolcolor_play=="")this.symbolcolor_play=esplayer_symbolcolor_play;if(this.basecolor_stop=="")this.basecolor_stop=esplayer_basecolor_stop;if(this.symbolcolor_stop=="")this.symbolcolor_stop=esplayer_symbolcolor_stop;if(this.basecolor_pause=="")this.basecolor_pause=esplayer_basecolor_pause;if(this.symbolcolor_pause=="")this.symbolcolor_pause=esplayer_symbolcolor_pause;if(this.color_slider_line=="")this.color_slider_line=esplayer_color_slider_line;if(this.color_slider_knob=="")this.color_slider_knob=esplayer_color_slider_knob;if(this.shw_rate==-999)this.shw_rate=esplayer_shadowsize;if(this.shw_color=="")this.shw_color=esplayer_shadowcolor;this.shw_size=Math.min(Math.min(this.width,this.height)*this.shw_rate,100);clearInterval(this.getsetting_id);this.setting_ok=true};EsAudioPlayer.prototype.initSound=function(){if(!this.created){if(this.mode=="slideshow"&&!esp_tt_data_ready){return}if(soundManager_ready){if(this.mode=="slideshow"){this.nowPlaying=0;var a;for(a=0;a<this.tt_id_list.length;a++){this.sURLs[a]=esp_tt_data[this.tt_id_list[a]].url;if(soundManager.canPlayURL(this.sURLs[a])){this.mySound[a]=soundManager.createSound({id:this.tt_id_list[a],url:this.sURLs[a],autoLoad:false,stream:true,autoPlay:false,volume:100})}this.mySoundPosition[a]=0}this.created=true}else{if(soundManager.canPlayURL(this.sURLs[0])){this.mySound[0]=soundManager.createSound({id:this.id,url:this.sURLs[0],autoLoad:false,stream:true,autoPlay:false,volume:100})}this.mySoundPosition[0]=0;this.created=true}}}};EsAudioPlayer.prototype.onClick=function(a){this.preventDrawing=false;this.ofs=jQuery(this.canvas).offset();var b=this.getEv(a).pageX-this.ofs.left;var c=this.getEv(a).pageY-this.ofs.top;var d=this.width>=this.height*2?this.height:this.width;if(b>=1&&c>=1&&b<d-this.shw_size&&c<this.height-this.shw_size){this.func_play_stop()}if(this.slider_x>0){var e=this.slider_width;var f=this.slider_height;if(b>this.slider_x-e*4&&b<this.slider_x+e*3.5&&c>this.slider_y-f/2-e*5&&c<this.slider_y+f/2+e*5){this.slider_mouse_ofs_x=b-this.slider_x;this.slider_mouse_ofs_y=c-this.slider_y;this.slider_drag=true;var g=this;jQuery(document).bind(this.isSmartphone?"touchmove":"mousemove",function(a){g.onMouseMove(a)});jQuery(document).bind(this.isSmartphone?"touchend":"mouseup",function(a){g.onMouseUp(a)});return}}if(b>=this.calc_sx(0)-this.slider_width/2&&c>=this.sy-this.slider_height/2&&b<=this.calc_sx(-1)+this.slider_width/2&&c<=this.sy+this.slider_height/2){this.slider_mouse_ofs_x=0;this.mySound.setPosition(this.calc_pos(b))}};EsAudioPlayer.prototype.getEv=function(a){return this.isSmartphone?window.event.changedTouches[0]:a};EsAudioPlayer.prototype.onMouseMove=function(a){this.slider_x=this.getEv(a).pageX-this.slider_mouse_ofs_x-this.ofs.left;this.slider_x=Math.max(this.calc_sx(0),this.slider_x);this.slider_x=Math.min(this.calc_sx(this.mySound[this.nowPlaying].duration),this.slider_x);this.preventDrawing=false;this.anim()};EsAudioPlayer.prototype.onMouseUp=function(a){this.mySound[this.nowPlaying].setPosition(this.calc_pos(this.slider_x));var b=this;jQuery(document).unbind("mousemove touchmove mouseup touchend");this.slider_drag=false};EsAudioPlayer.prototype.calc_sx=function(a){if(a<0)return this.sx_en;if(a==0)return this.sx_st;var b=this.mySound[this.nowPlaying];var c=this.duration>0?this.duration:b.durationEstimate;var d=b.bytesLoaded!=b.bytesTotal?c:b.duration;return this.sx_st+(this.sx_en-this.sx_st)*a/d};EsAudioPlayer.prototype.calc_pos=function(a){var b=this.mySound[this.nowPlaying];var c=this.duration>0?this.duration:b.durationEstimate;var d=b.bytesLoaded!=b.bytesTotal?c:b.duration;return(a-this.sx_st)/(this.sx_en-this.sx_st)*d};EsAudioPlayer.prototype.draw_button_base=function(a,b,c,d,e){var f=this.canvas.getContext("2d");this.ie_shadow(f,a,b,c,d);f.fillStyle=e;this.set_button_shadow(f,true);f.fillRect(a,b,c-a,d-b);this.set_button_shadow(f,false)};EsAudioPlayer.prototype.draw_play_button=function(a,b,c,d,e){var f=this.canvas.getContext("2d");f.beginPath();f.moveTo(a+(c-a)*.3,b+(d-b)*.25);f.lineTo(a+(c-a)*.8,b+(d-b)*.5);f.lineTo(a+(c-a)*.3,b+(d-b)*.75);f.closePath();f.fillStyle=e;f.fill()};EsAudioPlayer.prototype.draw_stop_button=function(a,b,c,d,e){var f=this.canvas.getContext("2d");f.fillStyle=e;f.fillRect(a+(c-a)*.3,b+(d-b)*.3,(c-a)*.4,(d-b)*.4)};EsAudioPlayer.prototype.draw_pause_button=function(a,b,c,d,e){var f=this.canvas.getContext("2d");f.fillStyle=e;f.fillRect(a+(c-a)*.25,b+(d-b)*.3,(c-a)*.2,(d-b)*.4);f.fillRect(a+(c-a)*.55,b+(d-b)*.3,(c-a)*.2,(d-b)*.4)};EsAudioPlayer.prototype.set_button_shadow=function(a,b){if(b){a.shadowBlur=this.shw_size*(this.isGecko?.5:.7);a.shadowOffsetX=this.shw_size/1.7;a.shadowOffsetY=this.shw_size/1.7*(this.isAndroid?-1:1);a.shadowColor=this.shw_color}else{a.shadowBlur=0;a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowColor="#000000"}};EsAudioPlayer.prototype.ie_shadow=function(a,b,c,d,e,f,g){if(this.isIE){a.fillStyle=this.shw_color;var g=this.shw_size;a.fillRect(b+g*.9,c+g*.9,d-b,e-c)}};EsAudioPlayer.prototype.anim=function(){if(this.mySound[this.nowPlaying]===undefined)return;if(this.mySound[this.nowPlaying].playState){this.flgInitializing_beforePlaying=false}if(this.play&&!this.mySound[this.nowPlaying].playState&&!this.flgInitializing_beforePlaying){this.func_stop()}if(!this.anim_ok||!this.setting_ok)return;if(this.preventDrawing)return;if(this.mode=="simple"){var a=this.canvas.getContext("2d");a.clearRect(0,0,this.canvas_width,this.canvas_height);var b=this.width>=this.height*2?this.height:this.width;if(this.play){if(this.pause){this.draw_button_base(0,0,this.width-0,this.height-0,this.basecolor_play);this.draw_play_button(0,0,b-0,this.height-0,this.symbolcolor_play)}else if(this.slider_length>0){this.draw_button_base(0,0,this.width-0,this.height-0,this.basecolor_pause);this.draw_pause_button(0,0,b-0,this.height-0,this.symbolcolor_pause)}else{this.draw_button_base(0,0,this.width-0,this.height-0,this.basecolor_stop);this.draw_stop_button(0,0,b-0,this.height-0,this.symbolcolor_stop)}}else{this.draw_button_base(0,0,this.width-0,this.height-0,this.basecolor_play);this.draw_play_button(0,0,b-0,this.height-0,this.symbolcolor_play)}if(this.slider_length>0){var c=this.height*.5;a.fillStyle=this.color_slider_line;a.fillRect(this.sx_st,c-this.height*.02/2,this.sx_en-this.sx_st,this.height*.02);var d=this.mySound[this.nowPlaying];if(!(d.bytesLoaded===undefined||d.bytesLoaded===null)){a.fillStyle=this.color_slider_line;a.fillRect(this.sx_st,c-this.height*.04/2,(this.sx_en-this.sx_st)*(d.bytesLoaded/d.bytesTotal),this.height*.04)}var e;if(d.position)e=d.position;else e=this.mySoundPosition[this.nowPlaying];var f=0;if(!this.slider_drag){this.slider_y=c;var g=this.duration>0?this.duration:d.durationEstimate;var h=d.bytesLoaded!=d.bytesTotal?g:d.duration;if(h){this.slider_x=this.sx_st+(this.sx_en-this.sx_st)*(e/h);f=this.slider_x-this.slider_width/2}else{f=this.sx_st-this.slider_width/2}}else{f=this.slider_x-this.slider_width/2}a.fillStyle=this.color_slider_knob;a.fillRect(f,c-this.slider_height/2,this.slider_width,this.slider_height)}}if(!this.created)return;if(!this.play)this.preventDrawing=true};EsAudioPlayer.prototype.func_play_stop=function(){var a="";if(arguments.length)a=arguments[0];if(!this.created)return;if(!this.play){this.func_stop_all_the_other_players()}if(this.pause){this.pause=false;this.mySound[this.nowPlaying].resume();return}if(!this.play){this.start_time=(new Date).getTime();this.mySound[this.nowPlaying].play();this.play=true;esp_playing_no++;this.flgInitializing_beforePlaying=true}else{if(this.slider_length>0&&a!="play/stop"||a=="play/pause"){this.mySound[this.nowPlaying].pause();this.pause=true}else if(a!="play"){this.func_stop();esp_playing_no--}}this.anim()};EsAudioPlayer.prototype.func_stop_all_the_other_players=function(){for(i=0;i<Array_EsAudioPlayer.length;i++){if(Array_EsAudioPlayer[i].id!=this.id){if(Array_EsAudioPlayer[i].play){Array_EsAudioPlayer[i].func_stop();if(!!Array_EsAudioPlayer[i].tt_obj){Array_EsAudioPlayer[i].tt_obj.stop_slideshow()}}}}};EsAudioPlayer.prototype.func_acc_play=function(){if(!this.play){this.preventDrawing=false;this.func_play_stop()}};EsAudioPlayer.prototype.func_acc_stop=function(){this.func_stop_all_the_other_players();this.func_stop()};EsAudioPlayer.prototype.func_acc_play_stop=function(){this.preventDrawing=false;this.func_play_stop("play/stop")};EsAudioPlayer.prototype.func_acc_play_pause=function(){this.preventDrawing=false;this.func_play_stop("play/pause")};EsAudioPlayer.prototype.func_acc_seek=function(a,b){var c=this.mySound[this.nowPlaying];var d=this.duration>0?this.duration:c.durationEstimate;var e=c.bytesLoaded!=c.bytesTotal?d:c.duration;var f=c.position;var g=0;if(b=="pct"){g=f+a*.01*e}else if(b=="sec"){g=f+a*1e3}if(g<0)g=0;if(g>e)return;c.setPosition(g);this.preventDrawing=false;this.anim()};EsAudioPlayer.prototype.func_stop=function(){this.mySound[this.nowPlaying].stop();this.mySound[this.nowPlaying].setPosition(0);this.play=false;this.pause=false;if(0){var a=this.mySound[this.nowPlaying].url;var b=this.mySound[this.nowPlaying].sID;this.mySound[this.nowPlaying].destruct();this.mySound[this.nowPlaying]=soundManager.createSound({id:b,url:a,autoLoad:false,stream:true,autoPlay:false,volume:100})}this.anim()};EsAudioPlayer.prototype.switch_music_by_ttid=function(a){var b;for(b=0;b<this.tt_id_list.length;b++){if(a==this.tt_id_list[b]){this.nowPlaying=b;return}}};EsAudioPlayer.prototype.getCurrentPosition=function(){var a=(new Date).getTime();var b=a-this.start_time;var c=this.mySound[this.nowPlaying].position;if(b<c){this.start_time=a-c}if(b>c&&b-c>500&&c<this.mySound[this.nowPlaying].duration){this.start_time=a-c}return a-this.start_time}